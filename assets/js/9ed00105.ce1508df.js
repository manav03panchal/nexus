"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[3873],{8633(e,n,s){s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>t,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"configuration","title":"Configuration Reference","description":"This document provides a complete reference for the Nexus DSL (Domain Specific Language) used in nexus.exs configuration files.","source":"@site/docs/configuration.md","sourceDirName":".","slug":"/configuration","permalink":"/nexus/configuration","draft":false,"unlisted":false,"editUrl":"https://github.com/manav03panchal/nexus/tree/main/website/docs/configuration.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"docsSidebar","previous":{"title":"Getting Started","permalink":"/nexus/getting-started"},"next":{"title":"CLI Reference","permalink":"/nexus/cli"}}');var r=s(4848),d=s(8453);const l={sidebar_position:3},t="Configuration Reference",o={},a=[{value:"Overview",id:"overview",level:2},{value:"File Structure",id:"file-structure",level:2},{value:"config",id:"config",level:2},{value:"Syntax",id:"syntax",level:3},{value:"Options",id:"options",level:3},{value:"Examples",id:"examples",level:3},{value:"Option Details",id:"option-details",level:3},{value:"<code>default_user</code>",id:"default_user",level:4},{value:"<code>default_port</code>",id:"default_port",level:4},{value:"<code>connect_timeout</code>",id:"connect_timeout",level:4},{value:"<code>command_timeout</code>",id:"command_timeout",level:4},{value:"<code>max_connections</code>",id:"max_connections",level:4},{value:"<code>continue_on_error</code>",id:"continue_on_error",level:4},{value:"host",id:"host",level:2},{value:"Syntax",id:"syntax-1",level:3},{value:"Parameters",id:"parameters",level:3},{value:"Connection String Formats",id:"connection-string-formats",level:3},{value:"How Defaults Are Applied",id:"how-defaults-are-applied",level:3},{value:"Host Names as Identifiers",id:"host-names-as-identifiers",level:3},{value:"Examples",id:"examples-1",level:3},{value:"group",id:"group",level:2},{value:"Syntax",id:"syntax-2",level:3},{value:"Parameters",id:"parameters-1",level:3},{value:"Examples",id:"examples-2",level:3},{value:"Using Groups in Tasks",id:"using-groups-in-tasks",level:3},{value:"Validation",id:"validation",level:3},{value:"task",id:"task",level:2},{value:"Syntax",id:"syntax-3",level:3},{value:"Parameters",id:"parameters-2",level:3},{value:"Task Options",id:"task-options",level:3},{value:"Basic Examples",id:"basic-examples",level:3},{value:"The <code>on</code> Option",id:"the-on-option",level:3},{value:"The <code>deps</code> Option",id:"the-deps-option",level:3},{value:"The <code>strategy</code> Option",id:"the-strategy-option",level:3},{value:"The <code>timeout</code> Option",id:"the-timeout-option",level:3},{value:"Empty Tasks",id:"empty-tasks",level:3},{value:"run",id:"run",level:2},{value:"Syntax",id:"syntax-4",level:3},{value:"Parameters",id:"parameters-3",level:3},{value:"Command Options",id:"command-options",level:3},{value:"Basic Examples",id:"basic-examples-1",level:3},{value:"The <code>sudo</code> Option",id:"the-sudo-option",level:3},{value:"The <code>timeout</code> Option",id:"the-timeout-option-1",level:3},{value:"The <code>retries</code> Option",id:"the-retries-option",level:3},{value:"Shell Features",id:"shell-features",level:3},{value:"Exit Codes",id:"exit-codes",level:3},{value:"env",id:"env",level:2},{value:"Syntax",id:"syntax-5",level:3},{value:"Parameters",id:"parameters-4",level:3},{value:"Return Value",id:"return-value",level:3},{value:"Examples",id:"examples-3",level:3},{value:"Important: Parse Time vs Runtime",id:"important-parse-time-vs-runtime",level:3},{value:"Common Patterns",id:"common-patterns",level:3},{value:"Validation",id:"validation-1",level:2},{value:"1. Syntax Errors",id:"1-syntax-errors",level:3},{value:"2. Unknown Config Options",id:"2-unknown-config-options",level:3},{value:"3. Task Dependency Validation",id:"3-task-dependency-validation",level:3},{value:"4. Host/Group Reference Validation",id:"4-hostgroup-reference-validation",level:3},{value:"5. Group Member Validation",id:"5-group-member-validation",level:3},{value:"6. Circular Dependency Detection",id:"6-circular-dependency-detection",level:3},{value:"7. Value Range Validation",id:"7-value-range-validation",level:3},{value:"Advanced Patterns",id:"advanced-patterns",level:2},{value:"Environment-Based Configuration",id:"environment-based-configuration",level:3},{value:"Generating Hosts Dynamically",id:"generating-hosts-dynamically",level:3},{value:"Shared Command Options",id:"shared-command-options",level:3},{value:"Including External Files",id:"including-external-files",level:3},{value:"Parameterized Tasks",id:"parameterized-tasks",level:3},{value:"Complete Example",id:"complete-example",level:2},{value:"See Also",id:"see-also",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,d.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"configuration-reference",children:"Configuration Reference"})}),"\n",(0,r.jsxs)(n.p,{children:["This document provides a complete reference for the Nexus DSL (Domain Specific Language) used in ",(0,r.jsx)(n.code,{children:"nexus.exs"})," configuration files."]}),"\n",(0,r.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsx)(n.p,{children:"Nexus uses an Elixir-based DSL for configuration, which means your config files are valid Elixir code. This provides:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Syntax highlighting"})," in any Elixir-aware editor"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Environment variable access"})," via ",(0,r.jsx)(n.code,{children:"System.get_env/1"})," or the ",(0,r.jsx)(n.code,{children:"env()"})," helper"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Conditional logic"})," using standard Elixir constructs"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Code reuse"})," through variables and functions"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"file-structure",children:"File Structure"}),"\n",(0,r.jsxs)(n.p,{children:["A typical ",(0,r.jsx)(n.code,{children:"nexus.exs"})," file has this structure:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-elixir",children:'# =============================================================================\n# CONFIGURATION - Global settings\n# =============================================================================\nconfig :nexus,\n  default_user: "deploy",\n  command_timeout: 60_000\n\n# =============================================================================\n# HOSTS - Define remote machines\n# =============================================================================\nhost :web1, "deploy@web1.example.com"\nhost :web2, "deploy@web2.example.com:2222"\n\n# =============================================================================\n# GROUPS - Organize hosts into logical groups\n# =============================================================================\ngroup :webservers, [:web1, :web2]\n\n# =============================================================================\n# TASKS - Define units of work\n# =============================================================================\ntask :deploy, on: :webservers, deps: [:build] do\n  run "deploy.sh"\nend\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"config",children:"config"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"config"})," macro sets global Nexus options."]}),"\n",(0,r.jsx)(n.h3,{id:"syntax",children:"Syntax"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-elixir",children:"config :nexus, options\n"})}),"\n",(0,r.jsx)(n.h3,{id:"options",children:"Options"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Option"}),(0,r.jsx)(n.th,{children:"Type"}),(0,r.jsx)(n.th,{children:"Default"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"default_user"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"String.t()"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"nil"})}),(0,r.jsx)(n.td,{children:"Default SSH username when not specified in host"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"default_port"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"pos_integer()"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"22"})}),(0,r.jsx)(n.td,{children:"Default SSH port when not specified in host"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"connect_timeout"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"pos_integer()"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"10_000"})}),(0,r.jsx)(n.td,{children:"SSH connection timeout in milliseconds"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"command_timeout"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"pos_integer()"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"60_000"})}),(0,r.jsx)(n.td,{children:"Default command execution timeout in milliseconds"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"max_connections"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"pos_integer()"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"5"})}),(0,r.jsx)(n.td,{children:"Maximum SSH connections per host in the pool"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"continue_on_error"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"boolean()"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"false"})}),(0,r.jsx)(n.td,{children:"Continue executing tasks if one fails"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"examples",children:"Examples"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-elixir",children:'# Basic configuration\nconfig :nexus,\n  default_user: "deploy",\n  default_port: 22\n\n# Production configuration with longer timeouts\nconfig :nexus,\n  default_user: "deploy",\n  connect_timeout: 30_000,      # 30 seconds\n  command_timeout: 300_000,     # 5 minutes\n  max_connections: 20,\n  continue_on_error: false\n\n# Using environment variables\nconfig :nexus,\n  default_user: env("DEPLOY_USER") || "deploy",\n  max_connections: String.to_integer(env("MAX_CONN") || "10")\n'})}),"\n",(0,r.jsx)(n.h3,{id:"option-details",children:"Option Details"}),"\n",(0,r.jsx)(n.h4,{id:"default_user",children:(0,r.jsx)(n.code,{children:"default_user"})}),"\n",(0,r.jsx)(n.p,{children:"The SSH username to use when not explicitly specified in a host definition:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-elixir",children:'config :nexus,\n  default_user: "deploy"\n\n# This host will use "deploy" as the user\nhost :web1, "192.168.1.10"\n\n# This host explicitly overrides to use "admin"\nhost :web2, "admin@192.168.1.11"\n'})}),"\n",(0,r.jsx)(n.h4,{id:"default_port",children:(0,r.jsx)(n.code,{children:"default_port"})}),"\n",(0,r.jsx)(n.p,{children:"The SSH port to use when not explicitly specified:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-elixir",children:'config :nexus,\n  default_port: 2222\n\n# All hosts will use port 2222 unless overridden\nhost :web1, "deploy@192.168.1.10"       # Uses port 2222\nhost :web2, "deploy@192.168.1.11:22"    # Explicitly uses port 22\n'})}),"\n",(0,r.jsx)(n.h4,{id:"connect_timeout",children:(0,r.jsx)(n.code,{children:"connect_timeout"})}),"\n",(0,r.jsx)(n.p,{children:"Maximum time to wait for SSH connection establishment:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-elixir",children:"config :nexus,\n  connect_timeout: 30_000   # 30 seconds\n\n# Useful for hosts with slow network connections\n# or when connecting through VPNs\n"})}),"\n",(0,r.jsx)(n.h4,{id:"command_timeout",children:(0,r.jsx)(n.code,{children:"command_timeout"})}),"\n",(0,r.jsx)(n.p,{children:"Default maximum time for command execution:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-elixir",children:'config :nexus,\n  command_timeout: 300_000  # 5 minutes\n\n# Can be overridden per-command:\ntask :long_running do\n  run "backup.sh", timeout: 3_600_000  # 1 hour\nend\n'})}),"\n",(0,r.jsx)(n.h4,{id:"max_connections",children:(0,r.jsx)(n.code,{children:"max_connections"})}),"\n",(0,r.jsx)(n.p,{children:"Maximum concurrent SSH connections per host:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-elixir",children:"config :nexus,\n  max_connections: 10\n\n# Prevents overwhelming hosts with too many connections\n# Connections are pooled and reused\n"})}),"\n",(0,r.jsx)(n.h4,{id:"continue_on_error",children:(0,r.jsx)(n.code,{children:"continue_on_error"})}),"\n",(0,r.jsx)(n.p,{children:"Controls pipeline behavior on task failure:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-elixir",children:"# Stop immediately on first failure (default)\nconfig :nexus,\n  continue_on_error: false\n\n# Continue executing remaining tasks\nconfig :nexus,\n  continue_on_error: true\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"host",children:"host"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"host"})," macro defines a remote machine for SSH connections."]}),"\n",(0,r.jsx)(n.h3,{id:"syntax-1",children:"Syntax"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-elixir",children:"host name, connection_string\n"})}),"\n",(0,r.jsx)(n.h3,{id:"parameters",children:"Parameters"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Parameter"}),(0,r.jsx)(n.th,{children:"Type"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"name"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"atom()"})}),(0,r.jsx)(n.td,{children:"Unique identifier for this host"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"connection_string"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"String.t()"})}),(0,r.jsx)(n.td,{children:"Connection details in various formats"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"connection-string-formats",children:"Connection String Formats"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-elixir",children:'# Hostname only (uses defaults for user and port)\nhost :server1, "example.com"\n\n# User and hostname\nhost :server2, "deploy@example.com"\n\n# User, hostname, and port\nhost :server3, "deploy@example.com:2222"\n\n# Hostname and port (no user)\nhost :server4, "example.com:2222"\n\n# IP addresses work the same way\nhost :server5, "192.168.1.10"\nhost :server6, "admin@10.0.0.5:22"\n'})}),"\n",(0,r.jsx)(n.h3,{id:"how-defaults-are-applied",children:"How Defaults Are Applied"}),"\n",(0,r.jsx)(n.p,{children:"When a connection string omits certain values, Nexus applies defaults:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-elixir",children:'config :nexus,\n  default_user: "deploy",\n  default_port: 22\n\n# Resulting host configurations:\nhost :h1, "example.com"\n# \u2192 hostname: "example.com", user: "deploy", port: 22\n\nhost :h2, "admin@example.com"\n# \u2192 hostname: "example.com", user: "admin", port: 22\n\nhost :h3, "example.com:2222"\n# \u2192 hostname: "example.com", user: "deploy", port: 2222\n\nhost :h4, "admin@example.com:2222"\n# \u2192 hostname: "example.com", user: "admin", port: 2222\n'})}),"\n",(0,r.jsx)(n.h3,{id:"host-names-as-identifiers",children:"Host Names as Identifiers"}),"\n",(0,r.jsx)(n.p,{children:"The host name (first argument) is used to reference the host elsewhere:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-elixir",children:'host :production_web, "deploy@web.prod.example.com"\n\n# Reference in a group\ngroup :production, [:production_web, :production_db]\n\n# Reference in a task\ntask :deploy, on: :production_web do\n  run "deploy.sh"\nend\n'})}),"\n",(0,r.jsx)(n.h3,{id:"examples-1",children:"Examples"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-elixir",children:'# Web servers\nhost :web1, "deploy@192.168.1.10"\nhost :web2, "deploy@192.168.1.11"\nhost :web3, "deploy@192.168.1.12:2222"\n\n# Database servers\nhost :db_primary, "dba@db1.internal:5432"\nhost :db_replica, "dba@db2.internal:5432"\n\n# Using environment variables for sensitive data\nhost :prod_web, "#{env("PROD_USER")}@#{env("PROD_HOST")}"\n\n# Staging environment\nhost :staging, "deploy@staging.example.com"\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"group",children:"group"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"group"})," macro creates a named collection of hosts for targeting multiple machines with a single reference."]}),"\n",(0,r.jsx)(n.h3,{id:"syntax-2",children:"Syntax"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-elixir",children:"group name, host_list\n"})}),"\n",(0,r.jsx)(n.h3,{id:"parameters-1",children:"Parameters"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Parameter"}),(0,r.jsx)(n.th,{children:"Type"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"name"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"atom()"})}),(0,r.jsx)(n.td,{children:"Unique identifier for this group"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"host_list"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"[atom()]"})}),(0,r.jsx)(n.td,{children:"List of host names to include"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"examples-2",children:"Examples"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-elixir",children:'# Define hosts first\nhost :web1, "deploy@192.168.1.10"\nhost :web2, "deploy@192.168.1.11"\nhost :web3, "deploy@192.168.1.12"\nhost :db_primary, "admin@db1.example.com"\nhost :db_replica, "admin@db2.example.com"\n\n# Create groups\ngroup :webservers, [:web1, :web2, :web3]\ngroup :databases, [:db_primary, :db_replica]\ngroup :all_production, [:web1, :web2, :web3, :db_primary, :db_replica]\n\n# Groups can reference the same hosts\ngroup :tier1, [:web1, :db_primary]\ngroup :tier2, [:web2, :db_replica]\n'})}),"\n",(0,r.jsx)(n.h3,{id:"using-groups-in-tasks",children:"Using Groups in Tasks"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-elixir",children:'# Deploy to all web servers\ntask :deploy, on: :webservers do\n  run "deploy.sh"\nend\n\n# Run on all production hosts\ntask :status, on: :all_production do\n  run "systemctl status myapp"\nend\n'})}),"\n",(0,r.jsx)(n.h3,{id:"validation",children:"Validation"}),"\n",(0,r.jsx)(n.p,{children:"Nexus validates that all hosts referenced in a group exist:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-elixir",children:"# This will fail validation - :web4 doesn't exist\ngroup :webservers, [:web1, :web2, :web4]\n# Error: group :webservers references unknown host :web4\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"task",children:"task"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"task"})," macro defines a unit of work containing one or more commands."]}),"\n",(0,r.jsx)(n.h3,{id:"syntax-3",children:"Syntax"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-elixir",children:'task name, options \\\\ [] do\n  run "command1"\n  run "command2", command_options\nend\n'})}),"\n",(0,r.jsx)(n.h3,{id:"parameters-2",children:"Parameters"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Parameter"}),(0,r.jsx)(n.th,{children:"Type"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"name"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"atom()"})}),(0,r.jsx)(n.td,{children:"Unique identifier for this task"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"options"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"keyword()"})}),(0,r.jsx)(n.td,{children:"Task configuration (see below)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"block"})}),(0,r.jsx)(n.td,{children:"block"}),(0,r.jsxs)(n.td,{children:["Contains ",(0,r.jsx)(n.code,{children:"run"})," commands"]})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"task-options",children:"Task Options"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Option"}),(0,r.jsx)(n.th,{children:"Type"}),(0,r.jsx)(n.th,{children:"Default"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"on"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"atom()"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:":local"})}),(0,r.jsxs)(n.td,{children:["Host, group, or ",(0,r.jsx)(n.code,{children:":local"})," to run on"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"deps"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"[atom()]"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"[]"})}),(0,r.jsx)(n.td,{children:"Tasks that must complete first"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"strategy"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:":parallel | :serial"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:":parallel"})}),(0,r.jsx)(n.td,{children:"How to execute across multiple hosts"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"timeout"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"pos_integer()"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"300_000"})}),(0,r.jsx)(n.td,{children:"Overall task timeout in milliseconds"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"basic-examples",children:"Basic Examples"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-elixir",children:'# Simple local task\ntask :build do\n  run "mix compile"\n  run "mix test"\nend\n\n# Task with dependencies\ntask :test, deps: [:compile] do\n  run "mix test"\nend\n\n# Task on a specific host\ntask :deploy, on: :web1 do\n  run "git pull origin main"\n  run "mix deps.get --only prod"\nend\n\n# Task on a group of hosts\ntask :restart, on: :webservers do\n  run "systemctl restart myapp", sudo: true\nend\n'})}),"\n",(0,r.jsxs)(n.h3,{id:"the-on-option",children:["The ",(0,r.jsx)(n.code,{children:"on"})," Option"]}),"\n",(0,r.jsx)(n.p,{children:"Specifies where the task runs:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-elixir",children:'# Run locally (default)\ntask :build, on: :local do\n  run "mix compile"\nend\n\n# Run on a single host\ntask :deploy, on: :web1 do\n  run "deploy.sh"\nend\n\n# Run on all hosts in a group\ntask :status, on: :webservers do\n  run "systemctl status myapp"\nend\n'})}),"\n",(0,r.jsxs)(n.h3,{id:"the-deps-option",children:["The ",(0,r.jsx)(n.code,{children:"deps"})," Option"]}),"\n",(0,r.jsx)(n.p,{children:"Defines task dependencies (DAG):"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-elixir",children:'task :deps do\n  run "mix deps.get"\nend\n\ntask :compile, deps: [:deps] do\n  run "mix compile"\nend\n\ntask :test, deps: [:compile] do\n  run "mix test"\nend\n\n# Multiple dependencies\ntask :deploy, deps: [:test, :build] do\n  run "deploy.sh"\nend\n'})}),"\n",(0,r.jsxs)(n.p,{children:["When you run ",(0,r.jsx)(n.code,{children:"nexus run deploy"}),", Nexus will:"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Build the dependency graph"}),"\n",(0,r.jsxs)(n.li,{children:["Determine execution order: ",(0,r.jsx)(n.code,{children:"deps"})," \u2192 ",(0,r.jsx)(n.code,{children:"compile"})," \u2192 ",(0,r.jsx)(n.code,{children:"test"}),"/",(0,r.jsx)(n.code,{children:"build"})," \u2192 ",(0,r.jsx)(n.code,{children:"deploy"})]}),"\n",(0,r.jsx)(n.li,{children:"Execute tasks in phases (parallel within phases when possible)"}),"\n"]}),"\n",(0,r.jsxs)(n.h3,{id:"the-strategy-option",children:["The ",(0,r.jsx)(n.code,{children:"strategy"})," Option"]}),"\n",(0,r.jsx)(n.p,{children:"Controls execution across multiple hosts:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-elixir",children:'# Parallel execution (default)\n# Runs on all hosts simultaneously\ntask :status, on: :webservers, strategy: :parallel do\n  run "systemctl status myapp"\nend\n\n# Serial execution\n# Runs on hosts one at a time (useful for rolling deployments)\ntask :restart, on: :webservers, strategy: :serial do\n  run "systemctl restart myapp", sudo: true\n  run "sleep 10"  # Wait for service to start\n  run "curl -f http://localhost:4000/health"  # Health check\nend\n'})}),"\n",(0,r.jsx)(n.p,{children:"Serial execution is critical for zero-downtime deployments:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-elixir",children:'task :rolling_deploy, on: :webservers, strategy: :serial do\n  # Remove from load balancer\n  run "consul maint -enable", sudo: true\n  run "sleep 5"  # Drain connections\n  \n  # Deploy\n  run "deploy.sh"\n  \n  # Health check\n  run "curl -f http://localhost:4000/health"\n  \n  # Re-add to load balancer\n  run "consul maint -disable", sudo: true\nend\n'})}),"\n",(0,r.jsxs)(n.h3,{id:"the-timeout-option",children:["The ",(0,r.jsx)(n.code,{children:"timeout"})," Option"]}),"\n",(0,r.jsx)(n.p,{children:"Sets the overall task timeout (in milliseconds):"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-elixir",children:'# Default: 5 minutes (300_000ms)\ntask :quick_task do\n  run "echo hello"\nend\n\n# Custom timeout: 1 hour\ntask :long_backup, on: :db_primary, timeout: 3_600_000 do\n  run "pg_dump myapp > /backups/dump.sql"\nend\n'})}),"\n",(0,r.jsx)(n.h3,{id:"empty-tasks",children:"Empty Tasks"}),"\n",(0,r.jsx)(n.p,{children:"Tasks can have no commands - useful for grouping dependencies:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-elixir",children:'task :build do\n  run "mix compile"\nend\n\ntask :test, deps: [:build] do\n  run "mix test"\nend\n\ntask :lint, deps: [:build] do\n  run "mix credo --strict"\nend\n\n# This task just ensures build, test, and lint all run\ntask :ci, deps: [:test, :lint] do\n  # No commands - just a dependency aggregator\nend\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"run",children:"run"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"run"})," macro adds a command to the current task."]}),"\n",(0,r.jsx)(n.h3,{id:"syntax-4",children:"Syntax"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-elixir",children:"run command, options \\\\ []\n"})}),"\n",(0,r.jsx)(n.h3,{id:"parameters-3",children:"Parameters"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Parameter"}),(0,r.jsx)(n.th,{children:"Type"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"command"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"String.t()"})}),(0,r.jsx)(n.td,{children:"Shell command to execute"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"options"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"keyword()"})}),(0,r.jsx)(n.td,{children:"Command configuration (see below)"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"command-options",children:"Command Options"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Option"}),(0,r.jsx)(n.th,{children:"Type"}),(0,r.jsx)(n.th,{children:"Default"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"sudo"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"boolean()"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"false"})}),(0,r.jsx)(n.td,{children:"Run command with sudo"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"user"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"String.t()"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"nil"})}),(0,r.jsx)(n.td,{children:"User to run as (with sudo)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"timeout"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"pos_integer()"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"60_000"})}),(0,r.jsx)(n.td,{children:"Command timeout in milliseconds"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"retries"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"non_neg_integer()"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"0"})}),(0,r.jsx)(n.td,{children:"Number of retry attempts on failure"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"retry_delay"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"pos_integer()"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"1_000"})}),(0,r.jsx)(n.td,{children:"Delay between retries in milliseconds"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"basic-examples-1",children:"Basic Examples"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-elixir",children:'task :example do\n  # Simple command\n  run "echo \'Hello, World!\'"\n  \n  # Command with options\n  run "apt-get update", sudo: true\n  \n  # Long-running command with extended timeout\n  run "mix test --slowest 10", timeout: 600_000\n  \n  # Retry on failure\n  run "flaky-command.sh", retries: 3, retry_delay: 5_000\nend\n'})}),"\n",(0,r.jsxs)(n.h3,{id:"the-sudo-option",children:["The ",(0,r.jsx)(n.code,{children:"sudo"})," Option"]}),"\n",(0,r.jsx)(n.p,{children:"Runs the command with elevated privileges:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-elixir",children:'task :maintenance, on: :webservers do\n  # Standard sudo (as root)\n  run "systemctl restart nginx", sudo: true\n  \n  # Sudo as specific user\n  run "whoami", sudo: true, user: "postgres"\n  # Runs: sudo -u postgres whoami\n  \n  # Multiple sudo commands\n  run "apt-get update", sudo: true\n  run "apt-get upgrade -y", sudo: true\nend\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Important"}),": For sudo to work without password prompts, configure ",(0,r.jsx)(n.code,{children:"/etc/sudoers"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"# Allow deploy user to run specific commands without password\ndeploy ALL=(ALL) NOPASSWD: /bin/systemctl restart nginx, /usr/bin/apt-get\n"})}),"\n",(0,r.jsxs)(n.h3,{id:"the-timeout-option-1",children:["The ",(0,r.jsx)(n.code,{children:"timeout"})," Option"]}),"\n",(0,r.jsx)(n.p,{children:"Sets command-specific timeout:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-elixir",children:'task :mixed_commands do\n  # Quick command (default 60s timeout)\n  run "echo \'Starting\'"\n  \n  # Long command with extended timeout\n  run "pg_dump database > backup.sql", timeout: 1_800_000  # 30 minutes\n  \n  # Quick verification\n  run "ls -la backup.sql"\nend\n'})}),"\n",(0,r.jsx)(n.p,{children:"If a command exceeds its timeout:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"The process is killed"}),"\n",(0,r.jsx)(n.li,{children:"The command is marked as failed"}),"\n",(0,r.jsx)(n.li,{children:"Retry logic applies if configured"}),"\n"]}),"\n",(0,r.jsxs)(n.h3,{id:"the-retries-option",children:["The ",(0,r.jsx)(n.code,{children:"retries"})," Option"]}),"\n",(0,r.jsx)(n.p,{children:"Automatically retry failed commands:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-elixir",children:'task :resilient_deploy do\n  # Retry up to 3 times with 5 second delay\n  run "curl -f https://api.example.com/health", retries: 3, retry_delay: 5_000\n  \n  # Retry with longer delay for slower operations\n  run "deploy.sh", retries: 2, retry_delay: 30_000\nend\n'})}),"\n",(0,r.jsx)(n.p,{children:"Retry behavior:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Uses ",(0,r.jsx)(n.strong,{children:"exponential backoff"}),": delay \xd7 2^(attempt-1)"]}),"\n",(0,r.jsxs)(n.li,{children:["Adds ",(0,r.jsx)(n.strong,{children:"20% jitter"})," to prevent thundering herd"]}),"\n",(0,r.jsxs)(n.li,{children:["Example with ",(0,r.jsx)(n.code,{children:"retry_delay: 5_000"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Attempt 1: immediate"}),"\n",(0,r.jsx)(n.li,{children:"Attempt 2: ~5 seconds later"}),"\n",(0,r.jsx)(n.li,{children:"Attempt 3: ~10 seconds later"}),"\n",(0,r.jsx)(n.li,{children:"Attempt 4: ~20 seconds later"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"shell-features",children:"Shell Features"}),"\n",(0,r.jsx)(n.p,{children:"Commands are executed in a shell, so you can use:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-elixir",children:'task :shell_features do\n  # Environment variables\n  run "echo $HOME"\n  run "export MY_VAR=value && echo $MY_VAR"\n  \n  # Pipes\n  run "cat /var/log/syslog | grep error | tail -10"\n  \n  # Redirects\n  run "echo \'log entry\' >> /var/log/myapp.log"\n  \n  # Command substitution\n  run "echo \\"Current date: $(date)\\""\n  \n  # Conditionals\n  run "[ -f /tmp/lock ] && echo \'locked\' || echo \'free\'"\n  \n  # Multiple commands\n  run "cd /opt/myapp && git pull && mix deps.get"\nend\n'})}),"\n",(0,r.jsx)(n.h3,{id:"exit-codes",children:"Exit Codes"}),"\n",(0,r.jsx)(n.p,{children:"Commands are considered:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Successful"}),": Exit code 0"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Failed"}),": Any non-zero exit code"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-elixir",children:'task :check_exit_codes do\n  run "exit 0"    # Success\n  run "exit 1"    # Failure - stops task (unless continue_on_error)\n  run "false"     # Failure (false returns exit code 1)\n  run "true"      # Success (true returns exit code 0)\nend\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"env",children:"env"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"env"})," function retrieves environment variable values."]}),"\n",(0,r.jsx)(n.h3,{id:"syntax-5",children:"Syntax"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-elixir",children:"env(variable_name)\n"})}),"\n",(0,r.jsx)(n.h3,{id:"parameters-4",children:"Parameters"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Parameter"}),(0,r.jsx)(n.th,{children:"Type"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsx)(n.tbody,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"variable_name"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"String.t() | atom()"})}),(0,r.jsx)(n.td,{children:"Name of the environment variable"})]})})]}),"\n",(0,r.jsx)(n.h3,{id:"return-value",children:"Return Value"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Returns the variable value as a string if set"}),"\n",(0,r.jsxs)(n.li,{children:["Returns empty string ",(0,r.jsx)(n.code,{children:'""'})," if not set"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"examples-3",children:"Examples"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-elixir",children:'# In configuration\nconfig :nexus,\n  default_user: env("DEPLOY_USER") || "deploy",\n  max_connections: String.to_integer(env("MAX_CONN") || "5")\n\n# In host definitions\nhost :production, "#{env("PROD_USER")}@#{env("PROD_HOST")}"\n\n# In tasks (at parse time, not runtime!)\ntask :deploy do\n  run "echo Deploying as #{env("USER")}"\nend\n'})}),"\n",(0,r.jsx)(n.h3,{id:"important-parse-time-vs-runtime",children:"Important: Parse Time vs Runtime"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsxs)(n.strong,{children:[(0,r.jsx)(n.code,{children:"env()"})," is evaluated when the config file is parsed"]}),", not when commands run:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-elixir",children:'# This captures MY_VAR at parse time\ntask :example do\n  run "echo #{env("MY_VAR")}"  # Evaluated when nexus.exs is loaded\nend\n\n# For runtime environment variables, use shell syntax:\ntask :runtime_example do\n  run "echo $MY_VAR"            # Evaluated when command runs\nend\n'})}),"\n",(0,r.jsx)(n.h3,{id:"common-patterns",children:"Common Patterns"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-elixir",children:'# Required environment variable with error\ndeploy_user = env("DEPLOY_USER")\nif deploy_user == "", do: raise "DEPLOY_USER not set!"\n\nconfig :nexus,\n  default_user: deploy_user\n\n# Optional with fallback\nconfig :nexus,\n  default_user: env("DEPLOY_USER") || "deploy",\n  max_connections: String.to_integer(env("MAX_CONN") || "5")\n\n# Conditional hosts based on environment\nif env("ENVIRONMENT") == "production" do\n  host :web1, "deploy@prod-web1.example.com"\n  host :web2, "deploy@prod-web2.example.com"\nelse\n  host :web1, "deploy@staging-web1.example.com"\nend\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"validation-1",children:"Validation"}),"\n",(0,r.jsx)(n.p,{children:"Nexus validates your configuration for:"}),"\n",(0,r.jsx)(n.h3,{id:"1-syntax-errors",children:"1. Syntax Errors"}),"\n",(0,r.jsx)(n.p,{children:"Invalid Elixir syntax is caught at parse time:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-elixir",children:"# Missing 'do'\ntask :broken\n  run \"echo hello\"\nend\n# Error: syntax error: missing 'do' in 'task'\n"})}),"\n",(0,r.jsx)(n.h3,{id:"2-unknown-config-options",children:"2. Unknown Config Options"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-elixir",children:'config :nexus,\n  invalid_option: "value"\n# Error: unknown config option: invalid_option\n'})}),"\n",(0,r.jsx)(n.h3,{id:"3-task-dependency-validation",children:"3. Task Dependency Validation"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-elixir",children:'task :deploy, deps: [:nonexistent] do\n  run "deploy.sh"\nend\n# Error: task :deploy depends on unknown task :nonexistent\n'})}),"\n",(0,r.jsx)(n.h3,{id:"4-hostgroup-reference-validation",children:"4. Host/Group Reference Validation"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-elixir",children:'task :deploy, on: :unknown_host do\n  run "deploy.sh"\nend\n# Error: task :deploy references unknown host or group :unknown_host\n'})}),"\n",(0,r.jsx)(n.h3,{id:"5-group-member-validation",children:"5. Group Member Validation"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-elixir",children:"group :webservers, [:web1, :nonexistent]\n# Error: group :webservers references unknown host :nonexistent\n"})}),"\n",(0,r.jsx)(n.h3,{id:"6-circular-dependency-detection",children:"6. Circular Dependency Detection"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-elixir",children:'task :a, deps: [:b] do\n  run "a"\nend\n\ntask :b, deps: [:a] do\n  run "b"\nend\n# Error: circular dependency detected: a -> b -> a\n'})}),"\n",(0,r.jsx)(n.h3,{id:"7-value-range-validation",children:"7. Value Range Validation"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-elixir",children:"config :nexus,\n  default_port: 99999  # Invalid port number\n# Error: default_port must be at most 65535, got: 99999\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"advanced-patterns",children:"Advanced Patterns"}),"\n",(0,r.jsx)(n.h3,{id:"environment-based-configuration",children:"Environment-Based Configuration"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-elixir",children:'# Determine environment\nenvironment = env("NEXUS_ENV") || "development"\n\n# Environment-specific settings\ncase environment do\n  "production" ->\n    config :nexus,\n      default_user: "deploy",\n      max_connections: 20,\n      command_timeout: 300_000\n      \n    host :web1, "deploy@prod-web1.example.com"\n    host :web2, "deploy@prod-web2.example.com"\n    host :web3, "deploy@prod-web3.example.com"\n    \n  "staging" ->\n    config :nexus,\n      default_user: "deploy",\n      max_connections: 5\n      \n    host :web1, "deploy@staging-web1.example.com"\n    \n  _ ->  # development\n    config :nexus,\n      default_user: System.get_env("USER"),\n      max_connections: 2\nend\n'})}),"\n",(0,r.jsx)(n.h3,{id:"generating-hosts-dynamically",children:"Generating Hosts Dynamically"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-elixir",children:'# Generate hosts from a range\nfor i <- 1..10 do\n  host_name = :"web#{i}"\n  host_string = "deploy@192.168.1.#{10 + i}"\n  host(host_name, host_string)\nend\n\n# Generate group from the same range\ngroup :webservers, Enum.map(1..10, &:"web#{&1}")\n'})}),"\n",(0,r.jsx)(n.h3,{id:"shared-command-options",children:"Shared Command Options"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-elixir",children:'# Define reusable options\n@sudo_opts [sudo: true]\n@retry_opts [retries: 3, retry_delay: 5_000]\n@long_timeout [timeout: 600_000]\n\ntask :maintenance, on: :webservers do\n  run "apt-get update", @sudo_opts\n  run "apt-get upgrade -y", @sudo_opts ++ @retry_opts\n  run "reboot", @sudo_opts\nend\n\ntask :backup, on: :db_primary do\n  run "pg_dump myapp > /backups/dump.sql", @long_timeout\nend\n'})}),"\n",(0,r.jsx)(n.h3,{id:"including-external-files",children:"Including External Files"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-elixir",children:'# In nexus.exs\nCode.require_file("nexus/hosts.exs")\nCode.require_file("nexus/tasks.exs")\n\n# Or use Code.eval_file for simple includes\n{hosts, _} = Code.eval_file("hosts.exs")\nEnum.each(hosts, fn {name, conn} -> host(name, conn) end)\n'})}),"\n",(0,r.jsx)(n.h3,{id:"parameterized-tasks",children:"Parameterized Tasks"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-elixir",children:'# Define a function that creates tasks\ndefmodule NexusTasks do\n  defmacro deploy_to(env, hosts) do\n    quote do\n      task unquote(:"deploy_#{env}"), on: unquote(hosts), deps: [:build] do\n        run "deploy.sh --env #{unquote(env)}"\n      end\n    end\n  end\nend\n\nimport NexusTasks\n\ndeploy_to(:staging, :staging_servers)\ndeploy_to(:production, :production_servers)\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"complete-example",children:"Complete Example"}),"\n",(0,r.jsxs)(n.p,{children:["Here's a complete, production-ready ",(0,r.jsx)(n.code,{children:"nexus.exs"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-elixir",children:'# =============================================================================\n# nexus.exs - Production Deployment Configuration\n# =============================================================================\n\n# -----------------------------------------------------------------------------\n# Environment Configuration\n# -----------------------------------------------------------------------------\nenvironment = env("NEXUS_ENV") || "production"\ndeploy_user = env("DEPLOY_USER") || "deploy"\n\nconfig :nexus,\n  default_user: deploy_user,\n  default_port: 22,\n  connect_timeout: 10_000,\n  command_timeout: 120_000,\n  max_connections: 10,\n  continue_on_error: false\n\n# -----------------------------------------------------------------------------\n# Hosts\n# -----------------------------------------------------------------------------\nhost :web1, "#{deploy_user}@10.0.1.10"\nhost :web2, "#{deploy_user}@10.0.1.11"\nhost :web3, "#{deploy_user}@10.0.1.12"\n\nhost :db_primary, "admin@10.0.2.10"\nhost :db_replica, "admin@10.0.2.11"\n\nhost :cache1, "#{deploy_user}@10.0.3.10"\nhost :cache2, "#{deploy_user}@10.0.3.11"\n\n# -----------------------------------------------------------------------------\n# Groups\n# -----------------------------------------------------------------------------\ngroup :web, [:web1, :web2, :web3]\ngroup :database, [:db_primary, :db_replica]\ngroup :cache, [:cache1, :cache2]\ngroup :all, [:web1, :web2, :web3, :db_primary, :db_replica, :cache1, :cache2]\n\n# -----------------------------------------------------------------------------\n# Build Tasks (Local)\n# -----------------------------------------------------------------------------\ntask :deps do\n  run "mix deps.get --only prod"\nend\n\ntask :compile, deps: [:deps] do\n  run "MIX_ENV=prod mix compile"\nend\n\ntask :assets, deps: [:deps] do\n  run "cd assets && npm ci && npm run deploy"\n  run "MIX_ENV=prod mix phx.digest"\nend\n\ntask :release, deps: [:compile, :assets] do\n  run "MIX_ENV=prod mix release --overwrite"\nend\n\n# -----------------------------------------------------------------------------\n# Deployment Tasks\n# -----------------------------------------------------------------------------\ntask :upload, on: :web, deps: [:release] do\n  run "mkdir -p /opt/myapp/releases"\n  # Note: actual file upload would use scp or similar\n  run "echo \'Upload complete\'"\nend\n\ntask :deploy, on: :web, deps: [:upload], strategy: :serial do\n  # Remove from load balancer\n  run "consul maint -enable -reason \'deploying\'", sudo: true\n  run "sleep 5"\n  \n  # Stop old version\n  run "systemctl stop myapp", sudo: true\n  \n  # Link new release\n  run "cd /opt/myapp && ln -sfn releases/latest current"\n  \n  # Start new version\n  run "systemctl start myapp", sudo: true\n  \n  # Wait and health check\n  run "sleep 10"\n  run "curl -f http://localhost:4000/health", retries: 5, retry_delay: 2_000\n  \n  # Re-enable in load balancer\n  run "consul maint -disable", sudo: true\nend\n\ntask :migrate, on: :db_primary, deps: [:deploy] do\n  run "/opt/myapp/current/bin/myapp eval \'MyApp.Release.migrate()\'"\nend\n\ntask :full_deploy, deps: [:migrate] do\n  run "echo \'Deployment complete!\'"\nend\n\n# -----------------------------------------------------------------------------\n# Operations Tasks\n# -----------------------------------------------------------------------------\ntask :status, on: :all do\n  run "hostname && uptime"\n  run "systemctl status myapp 2>/dev/null || echo \'myapp not installed\'"\nend\n\ntask :logs, on: :web do\n  run "journalctl -u myapp -n 50 --no-pager"\nend\n\ntask :restart, on: :web, strategy: :serial do\n  run "systemctl restart myapp", sudo: true\n  run "sleep 5"\n  run "curl -f http://localhost:4000/health", retries: 3, retry_delay: 2_000\nend\n\ntask :rollback, on: :web, strategy: :serial do\n  run "consul maint -enable", sudo: true\n  run "sleep 5"\n  run "cd /opt/myapp && ln -sfn releases/previous current"\n  run "systemctl restart myapp", sudo: true\n  run "sleep 10"\n  run "curl -f http://localhost:4000/health"\n  run "consul maint -disable", sudo: true\nend\n\n# -----------------------------------------------------------------------------\n# Maintenance Tasks\n# -----------------------------------------------------------------------------\ntask :backup, on: :db_primary do\n  run "pg_dump myapp_prod | gzip > /backups/myapp-$(date +%Y%m%d-%H%M%S).sql.gz",\n      timeout: 3_600_000  # 1 hour\nend\n\ntask :cleanup, on: :all do\n  run "docker system prune -f", sudo: true\n  run "journalctl --vacuum-time=7d", sudo: true\nend\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"see-also",children:"See Also"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/nexus/getting-started",children:"Getting Started"})," - Initial setup and first steps"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/nexus/cli",children:"CLI Reference"})," - Command-line interface documentation"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/nexus/ssh",children:"SSH Configuration"})," - SSH authentication and troubleshooting"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/nexus/examples",children:"Examples"})," - More real-world examples"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,d.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}}}]);