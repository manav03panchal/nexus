"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[8876],{2869(e,n,s){s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>t,default:()=>a,frontMatter:()=>r,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"ssh","title":"SSH Configuration","description":"Comprehensive guide to SSH authentication, key management, and troubleshooting for Nexus.","source":"@site/docs/ssh.md","sourceDirName":".","slug":"/ssh","permalink":"/nexus/ssh","draft":false,"unlisted":false,"editUrl":"https://github.com/manav03panchal/nexus/tree/main/website/docs/ssh.md","tags":[],"version":"current","sidebarPosition":7,"frontMatter":{"sidebar_position":7},"sidebar":"docsSidebar","previous":{"title":"Architecture","permalink":"/nexus/architecture"},"next":{"title":"Troubleshooting","permalink":"/nexus/troubleshooting"}}');var o=s(4848),d=s(8453);const r={sidebar_position:7},t="SSH Configuration",l={},c=[{value:"Overview",id:"overview",level:2},{value:"Authentication Methods",id:"authentication-methods",level:2},{value:"SSH Keys (Recommended)",id:"ssh-keys-recommended",level:3},{value:"Supported Key Types",id:"supported-key-types",level:4},{value:"Generating Keys",id:"generating-keys",level:4},{value:"Deploying Keys to Servers",id:"deploying-keys-to-servers",level:4},{value:"Key Permissions",id:"key-permissions",level:4},{value:"Using Keys with Nexus",id:"using-keys-with-nexus",level:4},{value:"SSH Agent",id:"ssh-agent",level:3},{value:"Starting the Agent",id:"starting-the-agent",level:4},{value:"Adding Keys",id:"adding-keys",level:4},{value:"Persistent Agent (macOS)",id:"persistent-agent-macos",level:4},{value:"Persistent Agent (Linux)",id:"persistent-agent-linux",level:4},{value:"Password Authentication",id:"password-authentication",level:3},{value:"SSH Config Integration",id:"ssh-config-integration",level:2},{value:"Supported Directives",id:"supported-directives",level:3},{value:"Example SSH Config",id:"example-ssh-config",level:3},{value:"Using SSH Config with Nexus",id:"using-ssh-config-with-nexus",level:3},{value:"Jump Hosts (Bastion)",id:"jump-hosts-bastion",level:3},{value:"Connection Pooling",id:"connection-pooling",level:2},{value:"How Pooling Works",id:"how-pooling-works",level:3},{value:"Pool Configuration",id:"pool-configuration",level:3},{value:"Pool Behavior",id:"pool-behavior",level:3},{value:"Performance Impact",id:"performance-impact",level:3},{value:"Security Best Practices",id:"security-best-practices",level:2},{value:"Key Management",id:"key-management",level:3},{value:"Limit Key Capabilities",id:"limit-key-capabilities",level:3},{value:"Use Dedicated Deploy Users",id:"use-dedicated-deploy-users",level:3},{value:"Host Key Verification",id:"host-key-verification",level:3},{value:"Audit and Rotate Keys",id:"audit-and-rotate-keys",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Connection Refused",id:"connection-refused",level:3},{value:"Authentication Failed",id:"authentication-failed",level:3},{value:"Connection Timeout",id:"connection-timeout",level:3},{value:"Host Key Verification Failed",id:"host-key-verification-failed",level:3},{value:"Permission Denied (publickey)",id:"permission-denied-publickey",level:3},{value:"Agent Not Found",id:"agent-not-found",level:3},{value:"Too Many Authentication Failures",id:"too-many-authentication-failures",level:3},{value:"Using Preflight to Diagnose",id:"using-preflight-to-diagnose",level:3},{value:"Advanced Configuration",id:"advanced-configuration",level:2},{value:"Custom SSH Options",id:"custom-ssh-options",level:3},{value:"Multiple Key Files",id:"multiple-key-files",level:3},{value:"SSH Over Non-Standard Ports",id:"ssh-over-non-standard-ports",level:3},{value:"Multiplexing (ControlMaster)",id:"multiplexing-controlmaster",level:3},{value:"See Also",id:"see-also",level:2}];function h(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,d.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"ssh-configuration",children:"SSH Configuration"})}),"\n",(0,o.jsx)(n.p,{children:"Comprehensive guide to SSH authentication, key management, and troubleshooting for Nexus."}),"\n",(0,o.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,o.jsx)(n.p,{children:"Nexus uses SSH to execute commands on remote hosts. This guide covers:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Authentication methods (keys, agent, password)"}),"\n",(0,o.jsx)(n.li,{children:"Key generation and management"}),"\n",(0,o.jsx)(n.li,{children:"SSH config file integration"}),"\n",(0,o.jsx)(n.li,{children:"Connection pooling"}),"\n",(0,o.jsx)(n.li,{children:"Troubleshooting common issues"}),"\n"]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"authentication-methods",children:"Authentication Methods"}),"\n",(0,o.jsx)(n.p,{children:"Nexus supports multiple authentication methods, tried in this order:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Explicit identity file"})," (",(0,o.jsx)(n.code,{children:"-i"})," flag or ",(0,o.jsx)(n.code,{children:"identity"})," option)"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Password"})," (if provided via ",(0,o.jsx)(n.code,{children:"--password"})," flag)"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"SSH agent"})," (if ",(0,o.jsx)(n.code,{children:"SSH_AUTH_SOCK"})," is set)"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Default key files"})," (",(0,o.jsx)(n.code,{children:"~/.ssh/id_ed25519"}),", etc.)"]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"ssh-keys-recommended",children:"SSH Keys (Recommended)"}),"\n",(0,o.jsx)(n.p,{children:"SSH keys provide secure, password-less authentication."}),"\n",(0,o.jsx)(n.h4,{id:"supported-key-types",children:"Supported Key Types"}),"\n",(0,o.jsxs)(n.table,{children:[(0,o.jsx)(n.thead,{children:(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.th,{children:"Type"}),(0,o.jsx)(n.th,{children:"File"}),(0,o.jsx)(n.th,{children:"Recommendation"})]})}),(0,o.jsxs)(n.tbody,{children:[(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"Ed25519"}),(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"id_ed25519"})}),(0,o.jsxs)(n.td,{children:[(0,o.jsx)(n.strong,{children:"Recommended"})," - Most secure, best performance"]})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"ECDSA"}),(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"id_ecdsa"})}),(0,o.jsx)(n.td,{children:"Good - Modern standard"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"RSA"}),(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"id_rsa"})}),(0,o.jsx)(n.td,{children:"Good - Widely supported"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"DSA"}),(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"id_dsa"})}),(0,o.jsx)(n.td,{children:"Not recommended - Deprecated"})]})]})]}),"\n",(0,o.jsx)(n.admonition,{title:"Key Recommendations",type:"tip",children:(0,o.jsx)(n.p,{children:"Ed25519 keys are recommended for best security and performance. All modern key formats (PEM and OpenSSH) are supported."})}),"\n",(0,o.jsx)(n.h4,{id:"generating-keys",children:"Generating Keys"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'# Generate Ed25519 key (recommended)\nssh-keygen -t ed25519 -C "deploy@nexus" -f ~/.ssh/nexus_deploy\n\n# Generate RSA key (if Ed25519 not supported)\nssh-keygen -t rsa -b 4096 -C "deploy@nexus" -f ~/.ssh/nexus_deploy\n\n# Generate key without passphrase (for automation)\nssh-keygen -t ed25519 -C "deploy@nexus" -f ~/.ssh/nexus_deploy -N ""\n'})}),"\n",(0,o.jsx)(n.h4,{id:"deploying-keys-to-servers",children:"Deploying Keys to Servers"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'# Copy key to server\nssh-copy-id -i ~/.ssh/nexus_deploy.pub user@server\n\n# Or manually append to authorized_keys\ncat ~/.ssh/nexus_deploy.pub | ssh user@server "mkdir -p ~/.ssh && cat >> ~/.ssh/authorized_keys"\n\n# For multiple servers\nfor server in web1 web2 web3; do\n  ssh-copy-id -i ~/.ssh/nexus_deploy.pub deploy@$server\ndone\n'})}),"\n",(0,o.jsx)(n.h4,{id:"key-permissions",children:"Key Permissions"}),"\n",(0,o.jsx)(n.p,{children:"SSH is strict about permissions:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# Private key must be readable only by owner\nchmod 600 ~/.ssh/nexus_deploy\n\n# Public key can be world-readable\nchmod 644 ~/.ssh/nexus_deploy.pub\n\n# .ssh directory\nchmod 700 ~/.ssh\n\n# authorized_keys on server\nchmod 600 ~/.ssh/authorized_keys\n"})}),"\n",(0,o.jsx)(n.h4,{id:"using-keys-with-nexus",children:"Using Keys with Nexus"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'# Specify key on command line\nnexus run deploy -i ~/.ssh/nexus_deploy\n\n# Or configure in nexus.exs (at parse time)\nhost :web1, "deploy@web1.example.com"  # Uses default keys\n\n# Key lookup order:\n# 1. ~/.ssh/id_ed25519\n# 2. ~/.ssh/id_ecdsa\n# 3. ~/.ssh/id_rsa\n# 4. ~/.ssh/id_dsa\n'})}),"\n",(0,o.jsx)(n.h3,{id:"ssh-agent",children:"SSH Agent"}),"\n",(0,o.jsx)(n.p,{children:"SSH agent provides convenient key management, especially with passphrase-protected keys."}),"\n",(0,o.jsx)(n.h4,{id:"starting-the-agent",children:"Starting the Agent"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'# Bash/Zsh\neval "$(ssh-agent -s)"\n\n# Fish\neval (ssh-agent -c)\n\n# Add to shell profile for persistence:\n# ~/.bashrc or ~/.zshrc\nif [ -z "$SSH_AUTH_SOCK" ]; then\n  eval "$(ssh-agent -s)"\nfi\n'})}),"\n",(0,o.jsx)(n.h4,{id:"adding-keys",children:"Adding Keys"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# Add default key\nssh-add\n\n# Add specific key\nssh-add ~/.ssh/nexus_deploy\n\n# Add with timeout (key expires after 1 hour)\nssh-add -t 3600 ~/.ssh/nexus_deploy\n\n# List loaded keys\nssh-add -l\n"})}),"\n",(0,o.jsx)(n.h4,{id:"persistent-agent-macos",children:"Persistent Agent (macOS)"}),"\n",(0,o.jsx)(n.p,{children:"macOS Keychain can store SSH keys persistently:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# Add key to Keychain\nssh-add --apple-use-keychain ~/.ssh/nexus_deploy\n\n# Configure SSH to use Keychain\n# ~/.ssh/config\nHost *\n  AddKeysToAgent yes\n  UseKeychain yes\n  IdentityFile ~/.ssh/nexus_deploy\n"})}),"\n",(0,o.jsx)(n.h4,{id:"persistent-agent-linux",children:"Persistent Agent (Linux)"}),"\n",(0,o.jsxs)(n.p,{children:["Use ",(0,o.jsx)(n.code,{children:"keychain"})," for persistent agent:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# Install keychain\nsudo apt install keychain\n\n# Add to ~/.bashrc\neval $(keychain --eval --agents ssh nexus_deploy)\n"})}),"\n",(0,o.jsx)(n.h3,{id:"password-authentication",children:"Password Authentication"}),"\n",(0,o.jsx)(n.p,{children:"Password authentication is supported but not recommended for automation."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# Nexus will prompt for password if no key is found\n# This is interactive and doesn't work well in scripts\n"})}),"\n",(0,o.jsx)(n.p,{children:"For non-interactive password authentication (not recommended):"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-elixir",children:"# In nexus.exs - NOT RECOMMENDED, password in plain text\nconfig :nexus,\n  # Don't do this in production!\n"})}),"\n",(0,o.jsx)(n.p,{children:"Instead, use SSH keys for automated deployments."}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"ssh-config-integration",children:"SSH Config Integration"}),"\n",(0,o.jsxs)(n.p,{children:["Nexus respects your ",(0,o.jsx)(n.code,{children:"~/.ssh/config"})," file for host-specific settings."]}),"\n",(0,o.jsx)(n.h3,{id:"supported-directives",children:"Supported Directives"}),"\n",(0,o.jsxs)(n.table,{children:[(0,o.jsx)(n.thead,{children:(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.th,{children:"Directive"}),(0,o.jsx)(n.th,{children:"Description"})]})}),(0,o.jsxs)(n.tbody,{children:[(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"Host"})}),(0,o.jsx)(n.td,{children:"Host pattern for matching"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"HostName"})}),(0,o.jsx)(n.td,{children:"Actual hostname/IP"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"User"})}),(0,o.jsx)(n.td,{children:"SSH username"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"Port"})}),(0,o.jsx)(n.td,{children:"SSH port"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"IdentityFile"})}),(0,o.jsx)(n.td,{children:"Path to private key"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"IdentitiesOnly"})}),(0,o.jsx)(n.td,{children:"Only use specified identity"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"ConnectTimeout"})}),(0,o.jsx)(n.td,{children:"Connection timeout"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"ProxyJump"})}),(0,o.jsx)(n.td,{children:"Jump host (bastion)"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"ProxyCommand"})}),(0,o.jsx)(n.td,{children:"Proxy command"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"ForwardAgent"})}),(0,o.jsx)(n.td,{children:"Forward SSH agent"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"StrictHostKeyChecking"})}),(0,o.jsx)(n.td,{children:"Host key verification"})]})]})]}),"\n",(0,o.jsx)(n.h3,{id:"example-ssh-config",children:"Example SSH Config"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"# ~/.ssh/config\n\n# Default settings for all hosts\nHost *\n  AddKeysToAgent yes\n  IdentitiesOnly yes\n  ServerAliveInterval 60\n  ServerAliveCountMax 3\n\n# Production web servers\nHost prod-web*\n  User deploy\n  IdentityFile ~/.ssh/prod_deploy\n  \nHost prod-web1\n  HostName 10.0.1.10\n\nHost prod-web2\n  HostName 10.0.1.11\n\nHost prod-web3\n  HostName 10.0.1.12\n  Port 2222\n\n# Staging\nHost staging-*\n  User deploy\n  IdentityFile ~/.ssh/staging_deploy\n  StrictHostKeyChecking no\n\nHost staging-web\n  HostName staging.example.com\n\n# Database servers\nHost db-*\n  User postgres\n  IdentityFile ~/.ssh/db_admin\n  \nHost db-primary\n  HostName 10.0.2.10\n\nHost db-replica\n  HostName 10.0.2.11\n\n# Jump host for private network\nHost bastion\n  HostName bastion.example.com\n  User admin\n  IdentityFile ~/.ssh/bastion_key\n\nHost private-*\n  ProxyJump bastion\n  \nHost private-app\n  HostName 192.168.1.10\n  User app\n"})}),"\n",(0,o.jsx)(n.h3,{id:"using-ssh-config-with-nexus",children:"Using SSH Config with Nexus"}),"\n",(0,o.jsxs)(n.p,{children:["When you define hosts in ",(0,o.jsx)(n.code,{children:"nexus.exs"}),", Nexus will look up settings in ",(0,o.jsx)(n.code,{children:"~/.ssh/config"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-elixir",children:'# nexus.exs\n# These hosts will use settings from ~/.ssh/config\n\nhost :web1, "prod-web1"     # Uses User=deploy, IdentityFile from config\nhost :web2, "prod-web2"     # Uses User=deploy, IdentityFile from config\nhost :staging, "staging-web" # Uses staging settings\nhost :db, "db-primary"       # Uses postgres user and db_admin key\n'})}),"\n",(0,o.jsx)(n.h3,{id:"jump-hosts-bastion",children:"Jump Hosts (Bastion)"}),"\n",(0,o.jsx)(n.p,{children:"For servers behind a bastion/jump host:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"# ~/.ssh/config\nHost bastion\n  HostName bastion.example.com\n  User admin\n  IdentityFile ~/.ssh/bastion_key\n\nHost internal-*\n  ProxyJump bastion\n  User deploy\n  IdentityFile ~/.ssh/internal_key\n\nHost internal-web1\n  HostName 192.168.1.10\n\nHost internal-web2\n  HostName 192.168.1.11\n"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-elixir",children:'# nexus.exs\nhost :web1, "internal-web1"  # Connects through bastion automatically\nhost :web2, "internal-web2"\n'})}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"connection-pooling",children:"Connection Pooling"}),"\n",(0,o.jsx)(n.p,{children:"Nexus maintains connection pools to improve performance."}),"\n",(0,o.jsx)(n.h3,{id:"how-pooling-works",children:"How Pooling Works"}),"\n",(0,o.jsx)(n.mermaid,{value:'flowchart LR\n    subgraph Pool["Pool per Host (max_connections: 5)"]\n        c1["Conn 1<br/>idle"]\n        c2["Conn 2<br/>in use"]\n        c3["Conn 3<br/>idle"]\n        c4["Conn 4<br/>idle"]\n        c5["..."]\n    end'}),"\n",(0,o.jsx)(n.h3,{id:"pool-configuration",children:"Pool Configuration"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-elixir",children:"config :nexus,\n  # Maximum connections per host\n  max_connections: 10,\n  \n  # Connection timeout\n  connect_timeout: 10_000  # 10 seconds\n"})}),"\n",(0,o.jsx)(n.h3,{id:"pool-behavior",children:"Pool Behavior"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Lazy Creation"}),": Connections are created on first use"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Reuse"}),": Idle connections are reused for new commands"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Validation"}),": Connections are validated before use"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Cleanup"}),": Invalid connections are removed and recreated"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Limits"}),": Never exceed ",(0,o.jsx)(n.code,{children:"max_connections"})," per host"]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"performance-impact",children:"Performance Impact"}),"\n",(0,o.jsxs)(n.table,{children:[(0,o.jsx)(n.thead,{children:(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.th,{children:"Scenario"}),(0,o.jsx)(n.th,{children:"Without Pooling"}),(0,o.jsx)(n.th,{children:"With Pooling"})]})}),(0,o.jsxs)(n.tbody,{children:[(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"10 commands on 1 host"}),(0,o.jsx)(n.td,{children:"10 connections (~1s)"}),(0,o.jsx)(n.td,{children:"1 connection (~0.1s)"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"10 commands on 5 hosts"}),(0,o.jsx)(n.td,{children:"50 connections (~5s)"}),(0,o.jsx)(n.td,{children:"5 connections (~0.5s)"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"100 commands on 10 hosts"}),(0,o.jsx)(n.td,{children:"1000 connections (~100s)"}),(0,o.jsx)(n.td,{children:"10 connections (~1s)"})]})]})]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"security-best-practices",children:"Security Best Practices"}),"\n",(0,o.jsx)(n.h3,{id:"key-management",children:"Key Management"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# Use separate keys for different environments\n~/.ssh/\n\u251c\u2500\u2500 id_ed25519           # Personal key\n\u251c\u2500\u2500 prod_deploy          # Production deployments\n\u251c\u2500\u2500 staging_deploy       # Staging deployments\n\u251c\u2500\u2500 ci_deploy            # CI/CD pipelines\n\u2514\u2500\u2500 bastion_key          # Bastion/jump host\n\n# Set restrictive permissions\nchmod 700 ~/.ssh\nchmod 600 ~/.ssh/*\nchmod 644 ~/.ssh/*.pub\n"})}),"\n",(0,o.jsx)(n.h3,{id:"limit-key-capabilities",children:"Limit Key Capabilities"}),"\n",(0,o.jsx)(n.p,{children:"On remote servers, restrict what keys can do:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:'# ~/.ssh/authorized_keys on server\n# Restrict to specific commands\ncommand="/opt/deploy/run.sh",no-port-forwarding,no-X11-forwarding,no-agent-forwarding ssh-ed25519 AAAA... deploy@nexus\n\n# Restrict source IP\nfrom="10.0.0.0/8",no-port-forwarding ssh-ed25519 AAAA... deploy@nexus\n'})}),"\n",(0,o.jsx)(n.h3,{id:"use-dedicated-deploy-users",children:"Use Dedicated Deploy Users"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'# Create deploy user on each server\nsudo useradd -m -s /bin/bash deploy\nsudo mkdir -p /home/deploy/.ssh\nsudo chmod 700 /home/deploy/.ssh\n\n# Add authorized key\necho "ssh-ed25519 AAAA... deploy@nexus" | sudo tee /home/deploy/.ssh/authorized_keys\nsudo chmod 600 /home/deploy/.ssh/authorized_keys\nsudo chown -R deploy:deploy /home/deploy/.ssh\n\n# Grant necessary sudo permissions (passwordless for specific commands)\necho "deploy ALL=(ALL) NOPASSWD: /bin/systemctl restart myapp, /bin/systemctl status myapp" | sudo tee /etc/sudoers.d/deploy\n'})}),"\n",(0,o.jsx)(n.h3,{id:"host-key-verification",children:"Host Key Verification"}),"\n",(0,o.jsx)(n.p,{children:"By default, SSH verifies host keys. For automation:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# Add host key to known_hosts before deploying\nssh-keyscan -H server.example.com >> ~/.ssh/known_hosts\n\n# Or in nexus.exs (less secure, but convenient for dynamic hosts)\n# This is done automatically by the -i flag behavior\n"})}),"\n",(0,o.jsx)(n.h3,{id:"audit-and-rotate-keys",children:"Audit and Rotate Keys"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# List all authorized keys on a server\ncat ~/.ssh/authorized_keys\n\n# Remove old/unused keys regularly\n# Add comments with dates for tracking\nssh-ed25519 AAAA... deploy@nexus # Added 2024-01-15, expires 2025-01-15\n\n# Rotate keys periodically\nssh-keygen -t ed25519 -f ~/.ssh/deploy_new\n# Deploy new key\n# Test access\n# Remove old key from authorized_keys\n"})}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,o.jsx)(n.h3,{id:"connection-refused",children:"Connection Refused"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:'Error: {:connection_refused, "192.168.1.10"}\n'})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Causes:"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"SSH server not running"}),"\n",(0,o.jsx)(n.li,{children:"Wrong port"}),"\n",(0,o.jsx)(n.li,{children:"Firewall blocking connection"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Solutions:"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# Check if SSH is running on server\nsudo systemctl status sshd\n\n# Check port\nnc -zv 192.168.1.10 22\n\n# Check firewall\nsudo ufw status\nsudo iptables -L -n | grep 22\n"})}),"\n",(0,o.jsx)(n.h3,{id:"authentication-failed",children:"Authentication Failed"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:'Error: {:auth_failed, "192.168.1.10"}\n'})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Causes:"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Wrong key"}),"\n",(0,o.jsx)(n.li,{children:"Key not in authorized_keys"}),"\n",(0,o.jsx)(n.li,{children:"Wrong username"}),"\n",(0,o.jsx)(n.li,{children:"Key permissions"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Solutions:"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# Test with verbose SSH\nssh -vvv deploy@192.168.1.10\n\n# Check key is loaded\nssh-add -l\n\n# Verify authorized_keys on server\ncat ~/.ssh/authorized_keys\n\n# Check permissions on server\nls -la ~/.ssh/\n# Should be:\n# drwx------ .ssh\n# -rw------- authorized_keys\n\n# Try specific key\nnexus run deploy -i ~/.ssh/specific_key\n"})}),"\n",(0,o.jsx)(n.h3,{id:"connection-timeout",children:"Connection Timeout"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:'Error: {:connection_timeout, "192.168.1.10"}\n'})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Causes:"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Network issues"}),"\n",(0,o.jsx)(n.li,{children:"Host unreachable"}),"\n",(0,o.jsx)(n.li,{children:"Firewall dropping packets"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Solutions:"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# Test connectivity\nping 192.168.1.10\n\n# Test TCP connection\nnc -zv -w 5 192.168.1.10 22\n\n# Increase timeout in config\nconfig :nexus,\n  connect_timeout: 30_000  # 30 seconds\n"})}),"\n",(0,o.jsx)(n.h3,{id:"host-key-verification-failed",children:"Host Key Verification Failed"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"Host key verification failed.\n"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Causes:"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Host not in known_hosts"}),"\n",(0,o.jsx)(n.li,{children:"Host key changed"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Solutions:"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# Add host to known_hosts\nssh-keyscan -H 192.168.1.10 >> ~/.ssh/known_hosts\n\n# If key changed legitimately\nssh-keygen -R 192.168.1.10\nssh-keyscan -H 192.168.1.10 >> ~/.ssh/known_hosts\n"})}),"\n",(0,o.jsx)(n.h3,{id:"permission-denied-publickey",children:"Permission Denied (publickey)"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"Permission denied (publickey)\n"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Causes:"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Key not authorized"}),"\n",(0,o.jsx)(n.li,{children:"Wrong username"}),"\n",(0,o.jsx)(n.li,{children:"SSH config issue"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Solutions:"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'# Check username\nssh -v deploy@192.168.1.10 2>&1 | grep "Trying private key"\n\n# Check what keys are being tried\nssh -v deploy@192.168.1.10 2>&1 | grep "Offering"\n\n# Force specific key\nssh -i ~/.ssh/deploy_key deploy@192.168.1.10\n\n# Check server logs\nsudo tail -f /var/log/auth.log\n'})}),"\n",(0,o.jsx)(n.h3,{id:"agent-not-found",children:"Agent Not Found"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"Could not open a connection to your authentication agent.\n"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Solutions:"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'# Start agent\neval "$(ssh-agent -s)"\n\n# Add key\nssh-add ~/.ssh/nexus_deploy\n\n# Check agent\necho $SSH_AUTH_SOCK\nssh-add -l\n'})}),"\n",(0,o.jsx)(n.h3,{id:"too-many-authentication-failures",children:"Too Many Authentication Failures"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"Received disconnect: Too many authentication failures\n"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Causes:"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Too many keys loaded in agent"}),"\n",(0,o.jsx)(n.li,{children:"SSH trying all keys"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Solutions:"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# Limit keys offered\n# ~/.ssh/config\nHost *\n  IdentitiesOnly yes\n\nHost myserver\n  IdentityFile ~/.ssh/specific_key\n\n# Or clear agent and add only needed key\nssh-add -D\nssh-add ~/.ssh/specific_key\n"})}),"\n",(0,o.jsx)(n.h3,{id:"using-preflight-to-diagnose",children:"Using Preflight to Diagnose"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'# Run preflight checks with verbose output\nnexus preflight deploy --verbose\n\n# Check specific hosts\nnexus preflight --verbose 2>&1 | grep -A5 "ssh:"\n'})}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"advanced-configuration",children:"Advanced Configuration"}),"\n",(0,o.jsx)(n.h3,{id:"custom-ssh-options",children:"Custom SSH Options"}),"\n",(0,o.jsx)(n.p,{children:"Nexus passes options to the underlying SSH library:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# Command line\nnexus run deploy \\\n  -i ~/.ssh/custom_key \\\n  -u custom_user\n"})}),"\n",(0,o.jsx)(n.h3,{id:"multiple-key-files",children:"Multiple Key Files"}),"\n",(0,o.jsx)(n.p,{children:"Use SSH config for host-specific keys:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"# ~/.ssh/config\nHost web*\n  IdentityFile ~/.ssh/web_deploy\n\nHost db*\n  IdentityFile ~/.ssh/db_admin\n\nHost *\n  IdentityFile ~/.ssh/default_key\n"})}),"\n",(0,o.jsx)(n.h3,{id:"ssh-over-non-standard-ports",children:"SSH Over Non-Standard Ports"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-elixir",children:'# nexus.exs\nhost :secure_server, "deploy@server.example.com:2222"\n\n# Or in SSH config\nHost secure\n  HostName server.example.com\n  Port 2222\n  User deploy\n'})}),"\n",(0,o.jsx)(n.h3,{id:"multiplexing-controlmaster",children:"Multiplexing (ControlMaster)"}),"\n",(0,o.jsxs)(n.p,{children:["For even better performance, enable SSH multiplexing in ",(0,o.jsx)(n.code,{children:"~/.ssh/config"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"Host *\n  ControlMaster auto\n  ControlPath ~/.ssh/sockets/%r@%h-%p\n  ControlPersist 600\n"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# Create socket directory\nmkdir -p ~/.ssh/sockets\nchmod 700 ~/.ssh/sockets\n"})}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"see-also",children:"See Also"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"/nexus/getting-started",children:"Getting Started"})," - Initial setup"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"/nexus/configuration",children:"Configuration Reference"})," - DSL documentation"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"/nexus/architecture",children:"Architecture"})," - How SSH pooling works internally"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"/nexus/troubleshooting",children:"Troubleshooting"})," - More debugging tips"]}),"\n"]})]})}function a(e={}){const{wrapper:n}={...(0,d.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(h,{...e})}):h(e)}}}]);