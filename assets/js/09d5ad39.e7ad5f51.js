"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[1864],{3973(e,n,t){t.r(n),t.d(n,{assets:()=>i,contentTitle:()=>l,default:()=>u,frontMatter:()=>o,metadata:()=>s,toc:()=>p});const s=JSON.parse('{"id":"examples","title":"Examples","description":"Real-world examples of Nexus configurations for common deployment scenarios.","source":"@site/docs/examples.md","sourceDirName":".","slug":"/examples","permalink":"/nexus/examples","draft":false,"unlisted":false,"editUrl":"https://github.com/manav03panchal/nexus/tree/main/website/docs/examples.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5},"sidebar":"docsSidebar","previous":{"title":"CLI Reference","permalink":"/nexus/cli"},"next":{"title":"Architecture","permalink":"/nexus/architecture"}}');var a=t(4848),r=t(8453);const o={sidebar_position:5},l="Examples",i={},p=[{value:"Table of Contents",id:"table-of-contents",level:2},{value:"Phoenix/Elixir Deployment",id:"phoenixelixir-deployment",level:2},{value:"Node.js Application",id:"nodejs-application",level:2},{value:"Docker Compose Deployment",id:"docker-compose-deployment",level:2},{value:"Multi-Environment Configuration",id:"multi-environment-configuration",level:2},{value:"Rolling Deployment with Health Checks",id:"rolling-deployment-with-health-checks",level:2},{value:"Database Operations",id:"database-operations",level:2},{value:"Static Site Deployment",id:"static-site-deployment",level:2},{value:"Server Maintenance",id:"server-maintenance",level:2},{value:"Blue-Green Deployment",id:"blue-green-deployment",level:2},{value:"Kubernetes Deployment",id:"kubernetes-deployment",level:2},{value:"See Also",id:"see-also",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"examples",children:"Examples"})}),"\n",(0,a.jsx)(n.p,{children:"Real-world examples of Nexus configurations for common deployment scenarios."}),"\n",(0,a.jsx)(n.h2,{id:"table-of-contents",children:"Table of Contents"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"#phoenixelixir-deployment",children:"Phoenix/Elixir Deployment"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"#nodejs-application",children:"Node.js Application"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"#docker-compose-deployment",children:"Docker Compose Deployment"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"#multi-environment-configuration",children:"Multi-Environment Configuration"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"#rolling-deployment-with-health-checks",children:"Rolling Deployment with Health Checks"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"#database-operations",children:"Database Operations"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"#static-site-deployment",children:"Static Site Deployment"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"#server-maintenance",children:"Server Maintenance"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"#blue-green-deployment",children:"Blue-Green Deployment"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"#kubernetes-deployment",children:"Kubernetes Deployment"})}),"\n"]}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"phoenixelixir-deployment",children:"Phoenix/Elixir Deployment"}),"\n",(0,a.jsx)(n.p,{children:"A complete deployment pipeline for a Phoenix application with database migrations."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-elixir",children:'# nexus.exs - Phoenix Application Deployment\n\n# =============================================================================\n# Configuration\n# =============================================================================\nconfig :nexus,\n  default_user: "deploy",\n  connect_timeout: 10_000,\n  command_timeout: 300_000,\n  max_connections: 10\n\n# =============================================================================\n# Hosts\n# =============================================================================\nhost :web1, "deploy@192.168.1.10"\nhost :web2, "deploy@192.168.1.11"\nhost :web3, "deploy@192.168.1.12"\nhost :db_primary, "postgres@192.168.2.10"\n\n# =============================================================================\n# Groups\n# =============================================================================\ngroup :web, [:web1, :web2, :web3]\n\n# =============================================================================\n# Build Tasks (Local)\n# =============================================================================\n\ntask :clean do\n  run "rm -rf _build/prod deps"\nend\n\ntask :deps do\n  run "mix deps.get --only prod"\nend\n\ntask :compile, deps: [:deps] do\n  run "MIX_ENV=prod mix compile"\nend\n\ntask :assets, deps: [:deps] do\n  run "cd assets && npm ci --silent"\n  run "cd assets && npm run deploy"\n  run "MIX_ENV=prod mix phx.digest"\nend\n\ntask :release, deps: [:compile, :assets] do\n  run "MIX_ENV=prod mix release --overwrite"\n  run "ls -la _build/prod/rel/myapp/"\nend\n\n# =============================================================================\n# Deployment Tasks\n# =============================================================================\n\ntask :backup_current, on: :web do\n  run "if [ -d /opt/myapp/current ]; then cp -r /opt/myapp/current /opt/myapp/rollback-$(date +%Y%m%d-%H%M%S); fi"\nend\n\ntask :upload, on: :web, deps: [:release] do\n  run "mkdir -p /opt/myapp/releases"\n  # In practice, you\'d use scp, rsync, or fetch from artifact storage\n  run "echo \'Uploading release...\'"\nend\n\ntask :deploy, on: :web, deps: [:upload, :backup_current], strategy: :serial do\n  # Drain connections from load balancer\n  run "if command -v consul &> /dev/null; then consul maint -enable -reason \'deploying\'; fi"\n  run "sleep 5"\n  \n  # Stop current version\n  run "systemctl stop myapp || true", sudo: true\n  \n  # Link new release\n  run "cd /opt/myapp && rm -f current && ln -s releases/latest current"\n  \n  # Start new version\n  run "systemctl start myapp", sudo: true\n  \n  # Wait for startup\n  run "sleep 10"\n  \n  # Health check with retries\n  run "curl -sf http://localhost:4000/health", retries: 5, retry_delay: 3_000\n  \n  # Re-enable in load balancer\n  run "if command -v consul &> /dev/null; then consul maint -disable; fi"\nend\n\ntask :migrate, on: :db_primary, deps: [:deploy] do\n  run "/opt/myapp/current/bin/myapp eval \'MyApp.Release.migrate()\'"\nend\n\ntask :full_deploy, deps: [:migrate] do\n  run "echo \'Deployment complete!\'"\nend\n\n# =============================================================================\n# Operations Tasks\n# =============================================================================\n\ntask :rollback, on: :web, strategy: :serial do\n  run "consul maint -enable -reason \'rollback\'"\n  run "sleep 5"\n  run "systemctl stop myapp", sudo: true\n  \n  # Find most recent rollback\n  run "cd /opt/myapp && LATEST=$(ls -td rollback-* | head -1) && rm -f current && ln -s $LATEST current"\n  \n  run "systemctl start myapp", sudo: true\n  run "sleep 10"\n  run "curl -sf http://localhost:4000/health"\n  run "consul maint -disable"\nend\n\ntask :logs, on: :web do\n  run "journalctl -u myapp -n 100 --no-pager"\nend\n\ntask :status, on: :web do\n  run "systemctl status myapp"\n  run "curl -s http://localhost:4000/health | jq ."\nend\n\ntask :restart, on: :web, strategy: :serial do\n  run "consul maint -enable"\n  run "sleep 5"\n  run "systemctl restart myapp", sudo: true\n  run "sleep 10"\n  run "curl -sf http://localhost:4000/health", retries: 3, retry_delay: 2_000\n  run "consul maint -disable"\nend\n'})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Usage:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Full deployment pipeline\nnexus run full_deploy\n\n# Just build locally\nnexus run release\n\n# Rollback to previous version\nnexus run rollback\n\n# View logs across all web servers\nnexus run logs\n"})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"nodejs-application",children:"Node.js Application"}),"\n",(0,a.jsx)(n.p,{children:"Deploying a Node.js application with PM2 process manager."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-elixir",children:'# nexus.exs - Node.js Application Deployment\n\nconfig :nexus,\n  default_user: "nodejs",\n  command_timeout: 120_000\n\nhost :app1, "nodejs@app1.example.com"\nhost :app2, "nodejs@app2.example.com"\n\ngroup :app_servers, [:app1, :app2]\n\n# Local build\ntask :install do\n  run "npm ci"\nend\n\ntask :build, deps: [:install] do\n  run "npm run build"\n  run "npm test"\nend\n\ntask :package, deps: [:build] do\n  run "tar -czf dist.tar.gz package.json package-lock.json dist/ node_modules/"\nend\n\n# Remote deployment\ntask :upload, on: :app_servers, deps: [:package] do\n  run "mkdir -p /opt/myapp/releases/$(date +%Y%m%d-%H%M%S)"\nend\n\ntask :deploy, on: :app_servers, deps: [:upload], strategy: :serial do\n  # Extract release\n  run "cd /opt/myapp/releases/$(ls /opt/myapp/releases | tail -1) && tar -xzf /tmp/dist.tar.gz"\n  \n  # Install production dependencies only\n  run "cd /opt/myapp/releases/$(ls /opt/myapp/releases | tail -1) && npm ci --production"\n  \n  # Update symlink\n  run "rm -f /opt/myapp/current && ln -s /opt/myapp/releases/$(ls /opt/myapp/releases | tail -1) /opt/myapp/current"\n  \n  # Reload PM2\n  run "pm2 reload ecosystem.config.js --update-env"\n  \n  # Health check\n  run "sleep 5"\n  run "curl -sf http://localhost:3000/health"\nend\n\ntask :rollback, on: :app_servers, strategy: :serial do\n  # Link to previous release\n  run "cd /opt/myapp/releases && PREV=$(ls -t | head -2 | tail -1) && rm -f /opt/myapp/current && ln -s /opt/myapp/releases/$PREV /opt/myapp/current"\n  run "pm2 reload ecosystem.config.js --update-env"\n  run "sleep 5"\n  run "curl -sf http://localhost:3000/health"\nend\n\ntask :logs, on: :app_servers do\n  run "pm2 logs --lines 50 --nostream"\nend\n\ntask :status, on: :app_servers do\n  run "pm2 status"\nend\n\n# Cleanup old releases (keep last 5)\ntask :cleanup, on: :app_servers do\n  run "cd /opt/myapp/releases && ls -t | tail -n +6 | xargs -r rm -rf"\nend\n'})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"docker-compose-deployment",children:"Docker Compose Deployment"}),"\n",(0,a.jsx)(n.p,{children:"Deploying applications using Docker Compose."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-elixir",children:'# nexus.exs - Docker Compose Deployment\n\nconfig :nexus,\n  default_user: "deploy",\n  command_timeout: 600_000  # 10 minutes for image pulls\n\nhost :docker1, "deploy@docker1.example.com"\nhost :docker2, "deploy@docker2.example.com"\n\ngroup :docker_hosts, [:docker1, :docker2]\n\n# Build and push images locally\ntask :build do\n  run "docker build -t myregistry.com/myapp:$(git rev-parse --short HEAD) ."\n  run "docker push myregistry.com/myapp:$(git rev-parse --short HEAD)"\nend\n\n# Deploy to Docker hosts\ntask :deploy, on: :docker_hosts, deps: [:build] do\n  # Pull latest images\n  run "docker compose pull"\n  \n  # Stop and recreate containers\n  run "docker compose up -d --remove-orphans"\n  \n  # Wait for health\n  run "sleep 10"\n  \n  # Verify containers are running\n  run "docker compose ps"\n  \n  # Health check\n  run "curl -sf http://localhost/health"\nend\n\ntask :rollback, on: :docker_hosts do\n  # Rollback to previous image\n  run "docker compose down"\n  run "docker tag myregistry.com/myapp:previous myregistry.com/myapp:latest"\n  run "docker compose up -d"\nend\n\ntask :logs, on: :docker_hosts do\n  run "docker compose logs --tail 100"\nend\n\ntask :status, on: :docker_hosts do\n  run "docker compose ps"\n  run "docker stats --no-stream"\nend\n\ntask :cleanup, on: :docker_hosts do\n  # Remove unused images and volumes\n  run "docker system prune -af --volumes", sudo: true\nend\n\ntask :restart, on: :docker_hosts, strategy: :serial do\n  run "docker compose restart"\n  run "sleep 10"\n  run "curl -sf http://localhost/health"\nend\n'})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"multi-environment-configuration",children:"Multi-Environment Configuration"}),"\n",(0,a.jsx)(n.p,{children:"Managing multiple environments (staging, production) in one config."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-elixir",children:'# nexus.exs - Multi-Environment Configuration\n\n# Determine environment from environment variable\nenvironment = System.get_env("NEXUS_ENV") || "staging"\n\n# Environment-specific configuration\ncase environment do\n  "production" ->\n    config :nexus,\n      default_user: "deploy",\n      command_timeout: 300_000,\n      max_connections: 20\n\n    host :web1, "deploy@prod-web1.example.com"\n    host :web2, "deploy@prod-web2.example.com"\n    host :web3, "deploy@prod-web3.example.com"\n    host :db, "postgres@prod-db.example.com"\n\n    group :web, [:web1, :web2, :web3]\n\n  "staging" ->\n    config :nexus,\n      default_user: "deploy",\n      command_timeout: 120_000,\n      max_connections: 5\n\n    host :web1, "deploy@staging-web1.example.com"\n    host :db, "postgres@staging-db.example.com"\n\n    group :web, [:web1]\n\n  _ ->\n    raise "Unknown environment: #{environment}. Set NEXUS_ENV to \'staging\' or \'production\'"\nend\n\n# =============================================================================\n# Tasks (same for all environments)\n# =============================================================================\n\ntask :build do\n  run "mix deps.get --only prod"\n  run "MIX_ENV=prod mix release --overwrite"\nend\n\ntask :deploy, on: :web, deps: [:build], strategy: :serial do\n  run "systemctl stop myapp", sudo: true\n  run "cd /opt/myapp && ln -sfn releases/latest current"\n  run "systemctl start myapp", sudo: true\n  run "sleep 10"\n  run "curl -sf http://localhost:4000/health"\nend\n\ntask :migrate, on: :db, deps: [:deploy] do\n  run "/opt/myapp/current/bin/myapp eval \'MyApp.Release.migrate()\'"\nend\n\ntask :full_deploy, deps: [:migrate] do\n  run "echo \'Deployed to #{environment}!\'"\nend\n\ntask :status, on: :web do\n  run "hostname"\n  run "systemctl status myapp"\nend\n'})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Usage:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Deploy to staging (default)\nnexus run full_deploy\n\n# Deploy to production\nNEXUS_ENV=production nexus run full_deploy\n\n# Check status in production\nNEXUS_ENV=production nexus run status\n"})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"rolling-deployment-with-health-checks",children:"Rolling Deployment with Health Checks"}),"\n",(0,a.jsx)(n.p,{children:"Zero-downtime deployment with rolling updates."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-elixir",children:'# nexus.exs - Rolling Deployment\n\nconfig :nexus,\n  default_user: "deploy",\n  command_timeout: 300_000\n\nhost :web1, "deploy@web1.example.com"\nhost :web2, "deploy@web2.example.com"\nhost :web3, "deploy@web3.example.com"\nhost :web4, "deploy@web4.example.com"\n\ngroup :web, [:web1, :web2, :web3, :web4]\n\ntask :build do\n  run "mix deps.get --only prod"\n  run "MIX_ENV=prod mix release --overwrite"\nend\n\n# Serial deployment ensures one host at a time\ntask :deploy, on: :web, deps: [:build], strategy: :serial do\n  # Step 1: Remove from load balancer\n  run "curl -X POST http://localhost:8500/v1/agent/service/deregister/myapp"\n  run "sleep 10"  # Allow in-flight requests to complete\n  \n  # Step 2: Stop the service\n  run "systemctl stop myapp", sudo: true\n  \n  # Step 3: Deploy new version\n  run "cd /opt/myapp && ln -sfn releases/$(date +%Y%m%d-%H%M%S) current"\n  \n  # Step 4: Start the service\n  run "systemctl start myapp", sudo: true\n  \n  # Step 5: Wait for service to be ready\n  run "sleep 10"\n  \n  # Step 6: Health check with retries\n  run """\n  for i in {1..30}; do\n    if curl -sf http://localhost:4000/health; then\n      echo "Health check passed"\n      exit 0\n    fi\n    echo "Attempt $i failed, retrying..."\n    sleep 2\n  done\n  echo "Health check failed after 30 attempts"\n  exit 1\n  """\n  \n  # Step 7: Re-register with load balancer\n  run """\n  curl -X PUT http://localhost:8500/v1/agent/service/register -d \'{\n    "Name": "myapp",\n    "Port": 4000,\n    "Check": {\n      "HTTP": "http://localhost:4000/health",\n      "Interval": "10s"\n    }\n  }\'\n  """\n  \n  # Step 8: Verify service is receiving traffic\n  run "sleep 5"\n  run "curl -s http://localhost:4000/health | grep -q \'ok\'"\nend\n\ntask :status, on: :web do\n  run "hostname"\n  run "systemctl status myapp --no-pager"\n  run "curl -s http://localhost:4000/health | jq ."\nend\n\ntask :rollback, on: :web, strategy: :serial do\n  run "curl -X POST http://localhost:8500/v1/agent/service/deregister/myapp"\n  run "sleep 10"\n  \n  run "systemctl stop myapp", sudo: true\n  \n  # Link to previous release\n  run "cd /opt/myapp && PREV=$(ls -td releases/*/ | head -2 | tail -1) && ln -sfn $PREV current"\n  \n  run "systemctl start myapp", sudo: true\n  run "sleep 10"\n  \n  run "curl -sf http://localhost:4000/health", retries: 10, retry_delay: 2_000\n  \n  run """\n  curl -X PUT http://localhost:8500/v1/agent/service/register -d \'{\n    "Name": "myapp",\n    "Port": 4000,\n    "Check": {"HTTP": "http://localhost:4000/health", "Interval": "10s"}\n  }\'\n  """\nend\n'})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"database-operations",children:"Database Operations"}),"\n",(0,a.jsx)(n.p,{children:"Common database maintenance tasks."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-elixir",children:'# nexus.exs - Database Operations\n\nconfig :nexus,\n  default_user: "postgres",\n  command_timeout: 3_600_000  # 1 hour for long operations\n\nhost :db_primary, "postgres@db-primary.example.com"\nhost :db_replica1, "postgres@db-replica1.example.com"\nhost :db_replica2, "postgres@db-replica2.example.com"\n\ngroup :replicas, [:db_replica1, :db_replica2]\ngroup :all_dbs, [:db_primary, :db_replica1, :db_replica2]\n\n# Backup\ntask :backup, on: :db_primary do\n  run "mkdir -p /backups/$(date +%Y%m)"\n  run """\n  pg_dump myapp_production \\\n    --format=custom \\\n    --compress=9 \\\n    --file=/backups/$(date +%Y%m)/myapp-$(date +%Y%m%d-%H%M%S).dump\n  """\n  run "ls -lh /backups/$(date +%Y%m)/ | tail -5"\nend\n\n# Restore (be careful!)\ntask :restore, on: :db_primary do\n  run "echo \'WARNING: This will overwrite the database!\'"\n  run "pg_restore --clean --if-exists --dbname=myapp_production /backups/latest.dump"\nend\n\n# Vacuum and analyze\ntask :vacuum, on: :db_primary do\n  run "vacuumdb --analyze --verbose myapp_production"\nend\n\n# Reindex\ntask :reindex, on: :db_primary do\n  run "reindexdb --verbose myapp_production"\nend\n\n# Check replication status\ntask :replication_status, on: :db_primary do\n  run """\n  psql -c "SELECT client_addr, state, sent_lsn, write_lsn, flush_lsn, replay_lsn,\n           pg_wal_lsn_diff(sent_lsn, replay_lsn) AS lag_bytes\n           FROM pg_stat_replication;"\n  """\nend\n\n# Check replica lag\ntask :check_lag, on: :replicas do\n  run """\n  psql -c "SELECT now() - pg_last_xact_replay_timestamp() AS replication_lag;"\n  """\nend\n\n# Database size\ntask :db_size, on: :all_dbs do\n  run "hostname"\n  run """\n  psql -c "SELECT pg_database.datname,\n           pg_size_pretty(pg_database_size(pg_database.datname)) AS size\n           FROM pg_database\n           ORDER BY pg_database_size(pg_database.datname) DESC;"\n  """\nend\n\n# Table sizes\ntask :table_sizes, on: :db_primary do\n  run """\n  psql myapp_production -c "\n    SELECT schemaname, tablename,\n           pg_size_pretty(pg_total_relation_size(schemaname || \'.\' || tablename)) AS total_size,\n           pg_size_pretty(pg_relation_size(schemaname || \'.\' || tablename)) AS table_size,\n           pg_size_pretty(pg_indexes_size(schemaname || \'.\' || tablename)) AS index_size\n    FROM pg_tables\n    WHERE schemaname = \'public\'\n    ORDER BY pg_total_relation_size(schemaname || \'.\' || tablename) DESC\n    LIMIT 20;\n  "\n  """\nend\n\n# Long running queries\ntask :long_queries, on: :db_primary do\n  run """\n  psql -c "SELECT pid, now() - pg_stat_activity.query_start AS duration, query\n           FROM pg_stat_activity\n           WHERE (now() - pg_stat_activity.query_start) > interval \'5 minutes\'\n           AND state = \'active\';"\n  """\nend\n\n# Kill long running queries\ntask :kill_long_queries, on: :db_primary do\n  run """\n  psql -c "SELECT pg_terminate_backend(pid)\n           FROM pg_stat_activity\n           WHERE (now() - pg_stat_activity.query_start) > interval \'1 hour\'\n           AND state = \'active\'\n           AND query NOT LIKE \'%pg_stat_activity%\';"\n  """\nend\n\n# Cleanup old backups (keep last 7 days)\ntask :cleanup_backups, on: :db_primary do\n  run "find /backups -name \'*.dump\' -mtime +7 -delete"\n  run "df -h /backups"\nend\n'})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"static-site-deployment",children:"Static Site Deployment"}),"\n",(0,a.jsx)(n.p,{children:"Deploying a static site (Hugo, Jekyll, etc.) to multiple servers."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-elixir",children:'# nexus.exs - Static Site Deployment\n\nconfig :nexus,\n  default_user: "www-data",\n  command_timeout: 60_000\n\nhost :cdn1, "www-data@cdn1.example.com"\nhost :cdn2, "www-data@cdn2.example.com"\n\ngroup :cdn, [:cdn1, :cdn2]\n\n# Build static site locally\ntask :build do\n  run "hugo --minify"\n  run "tar -czf site.tar.gz -C public ."\nend\n\n# Deploy to CDN servers\ntask :deploy, on: :cdn, deps: [:build] do\n  run "mkdir -p /var/www/mysite/releases/$(date +%Y%m%d-%H%M%S)"\nend\n\ntask :activate, on: :cdn, deps: [:deploy] do\n  # Extract to new release directory\n  run "cd /var/www/mysite/releases/$(ls /var/www/mysite/releases | tail -1) && tar -xzf /tmp/site.tar.gz"\n  \n  # Update symlink\n  run "ln -sfn /var/www/mysite/releases/$(ls /var/www/mysite/releases | tail -1) /var/www/mysite/current"\n  \n  # Reload nginx\n  run "nginx -t && systemctl reload nginx", sudo: true\nend\n\ntask :rollback, on: :cdn do\n  run "cd /var/www/mysite/releases && PREV=$(ls -t | head -2 | tail -1) && ln -sfn /var/www/mysite/releases/$PREV /var/www/mysite/current"\n  run "systemctl reload nginx", sudo: true\nend\n\ntask :purge_cache, on: :cdn do\n  run "rm -rf /var/cache/nginx/*"\n  run "systemctl reload nginx", sudo: true\nend\n\ntask :cleanup, on: :cdn do\n  # Keep last 5 releases\n  run "cd /var/www/mysite/releases && ls -t | tail -n +6 | xargs -r rm -rf"\nend\n\ntask :full_deploy, deps: [:activate, :purge_cache] do\n  run "echo \'Site deployed!\'"\nend\n'})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"server-maintenance",children:"Server Maintenance"}),"\n",(0,a.jsx)(n.p,{children:"Common server maintenance tasks."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-elixir",children:'# nexus.exs - Server Maintenance\n\nconfig :nexus,\n  default_user: "admin",\n  command_timeout: 600_000\n\nhost :server1, "admin@server1.example.com"\nhost :server2, "admin@server2.example.com"\nhost :server3, "admin@server3.example.com"\n\ngroup :all, [:server1, :server2, :server3]\n\n# System updates\ntask :update, on: :all do\n  run "apt-get update", sudo: true\n  run "apt-get upgrade -y", sudo: true\nend\n\ntask :reboot, on: :all, strategy: :serial do\n  run "shutdown -r +1 \'Scheduled reboot\'", sudo: true\nend\n\n# Disk usage\ntask :disk, on: :all do\n  run "hostname"\n  run "df -h"\nend\n\n# Memory usage\ntask :memory, on: :all do\n  run "hostname"\n  run "free -h"\nend\n\n# CPU usage\ntask :cpu, on: :all do\n  run "hostname"\n  run "top -bn1 | head -20"\nend\n\n# Process list\ntask :processes, on: :all do\n  run "hostname"\n  run "ps aux --sort=-%mem | head -20"\nend\n\n# Logs\ntask :syslog, on: :all do\n  run "tail -100 /var/log/syslog"\nend\n\ntask :auth_log, on: :all do\n  run "tail -100 /var/log/auth.log", sudo: true\nend\n\n# Security updates only\ntask :security_update, on: :all do\n  run "apt-get update", sudo: true\n  run "apt-get install --only-upgrade -y $(apt-get -s upgrade | grep -i security | awk \'{print $2}\')", sudo: true\nend\n\n# Cleanup\ntask :cleanup, on: :all do\n  run "apt-get autoremove -y", sudo: true\n  run "apt-get autoclean", sudo: true\n  run "journalctl --vacuum-time=7d", sudo: true\n  run "find /tmp -type f -atime +7 -delete", sudo: true\nend\n\n# Check for failed services\ntask :check_services, on: :all do\n  run "hostname"\n  run "systemctl --failed"\nend\n\n# Uptime\ntask :uptime, on: :all do\n  run "hostname && uptime"\nend\n'})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"blue-green-deployment",children:"Blue-Green Deployment"}),"\n",(0,a.jsx)(n.p,{children:"Blue-green deployment pattern for zero-downtime updates."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-elixir",children:'# nexus.exs - Blue-Green Deployment\n\nconfig :nexus,\n  default_user: "deploy",\n  command_timeout: 300_000\n\n# Blue environment\nhost :blue1, "deploy@blue1.example.com"\nhost :blue2, "deploy@blue2.example.com"\n\n# Green environment  \nhost :green1, "deploy@green1.example.com"\nhost :green2, "deploy@green2.example.com"\n\n# Load balancer\nhost :lb, "admin@lb.example.com"\n\ngroup :blue, [:blue1, :blue2]\ngroup :green, [:green1, :green2]\n\n# Determine which environment is active\n# In practice, you\'d query your load balancer or use a state file\nactive_env = System.get_env("ACTIVE_ENV") || "blue"\ninactive_env = if active_env == "blue", do: "green", else: "blue"\ntarget_group = String.to_atom(inactive_env)\n\ntask :build do\n  run "mix deps.get --only prod"\n  run "MIX_ENV=prod mix release --overwrite"\nend\n\n# Deploy to inactive environment\ntask :deploy_inactive, on: target_group, deps: [:build] do\n  run "systemctl stop myapp", sudo: true\n  run "cd /opt/myapp && ln -sfn releases/latest current"\n  run "systemctl start myapp", sudo: true\n  run "sleep 15"\n  run "curl -sf http://localhost:4000/health", retries: 5, retry_delay: 3_000\nend\n\n# Verify inactive environment\ntask :verify_inactive, on: target_group, deps: [:deploy_inactive] do\n  run "curl -sf http://localhost:4000/health"\n  run "curl -sf http://localhost:4000/api/version"\nend\n\n# Switch traffic\ntask :switch, on: :lb, deps: [:verify_inactive] do\n  run """\n  # Update nginx upstream to point to #{inactive_env}\n  sed -i \'s/upstream active/upstream #{active_env}_backup/g\' /etc/nginx/sites-enabled/myapp\n  sed -i \'s/upstream #{inactive_env}/upstream active/g\' /etc/nginx/sites-enabled/myapp\n  nginx -t && systemctl reload nginx\n  """, sudo: true\nend\n\n# Full blue-green deploy\ntask :blue_green_deploy, deps: [:switch] do\n  run "echo \'Traffic switched to #{inactive_env}\'"\n  run "echo \'Previous active: #{active_env}\'"\nend\n\n# Rollback (switch back)\ntask :rollback, on: :lb do\n  run """\n  # Switch back to #{active_env}\n  sed -i \'s/upstream active/upstream #{inactive_env}_backup/g\' /etc/nginx/sites-enabled/myapp\n  sed -i \'s/upstream #{active_env}/upstream active/g\' /etc/nginx/sites-enabled/myapp\n  nginx -t && systemctl reload nginx\n  """, sudo: true\nend\n\ntask :status do\n  run "echo \'Active environment: #{active_env}\'"\n  run "echo \'Inactive environment: #{inactive_env}\'"\nend\n'})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Usage:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Deploy to inactive environment and switch\nACTIVE_ENV=blue nexus run blue_green_deploy\n\n# Rollback to previous environment\nACTIVE_ENV=green nexus run rollback\n"})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"kubernetes-deployment",children:"Kubernetes Deployment"}),"\n",(0,a.jsx)(n.p,{children:"Deploying to Kubernetes clusters."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-elixir",children:'# nexus.exs - Kubernetes Deployment\n\nconfig :nexus,\n  default_user: "deploy",\n  command_timeout: 600_000\n\nhost :k8s_bastion, "deploy@bastion.k8s.example.com"\n\n# Build and push container\ntask :build do\n  run "docker build -t myregistry.com/myapp:$(git rev-parse --short HEAD) ."\n  run "docker push myregistry.com/myapp:$(git rev-parse --short HEAD)"\nend\n\n# Deploy to Kubernetes\ntask :deploy, on: :k8s_bastion, deps: [:build] do\n  # Update image in deployment\n  run """\n  kubectl set image deployment/myapp \\\n    myapp=myregistry.com/myapp:$(git rev-parse --short HEAD) \\\n    --record\n  """\n  \n  # Wait for rollout\n  run "kubectl rollout status deployment/myapp --timeout=5m"\nend\n\n# Rollback\ntask :rollback, on: :k8s_bastion do\n  run "kubectl rollout undo deployment/myapp"\n  run "kubectl rollout status deployment/myapp --timeout=5m"\nend\n\n# Scale\ntask :scale_up, on: :k8s_bastion do\n  run "kubectl scale deployment/myapp --replicas=5"\nend\n\ntask :scale_down, on: :k8s_bastion do\n  run "kubectl scale deployment/myapp --replicas=2"\nend\n\n# Status\ntask :status, on: :k8s_bastion do\n  run "kubectl get pods -l app=myapp"\n  run "kubectl get deployment myapp"\n  run "kubectl get hpa myapp"\nend\n\n# Logs\ntask :logs, on: :k8s_bastion do\n  run "kubectl logs -l app=myapp --tail=100"\nend\n\n# Exec into pod\ntask :shell, on: :k8s_bastion do\n  run "kubectl exec -it $(kubectl get pods -l app=myapp -o jsonpath=\'{.items[0].metadata.name}\') -- /bin/sh"\nend\n\n# Restart all pods\ntask :restart, on: :k8s_bastion do\n  run "kubectl rollout restart deployment/myapp"\n  run "kubectl rollout status deployment/myapp --timeout=5m"\nend\n\n# Health check\ntask :health, on: :k8s_bastion do\n  run "kubectl get pods -l app=myapp -o jsonpath=\'{range .items[*]}{.metadata.name}{\\"\\\\t\\"}{.status.phase}{\\"\\\\n\\"}{end}\'"\nend\n'})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"see-also",children:"See Also"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/nexus/getting-started",children:"Getting Started"})," - Initial setup guide"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/nexus/configuration",children:"Configuration Reference"})," - Complete DSL documentation"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/nexus/cli",children:"CLI Reference"})," - Command-line options"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/nexus/ssh",children:"SSH Configuration"})," - SSH authentication details"]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}}}]);